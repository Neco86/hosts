(self.webpackChunktest=self.webpackChunktest||[]).push([[371],{75941:function($){$.exports={wrapper:"wrapper___3iih1",config:"config___1jRLL",workArea:"workArea___3Z94m",input:"input___3IKyb",btn:"btn___h4QN4",parseResult:"parseResult___2m4fz",row:"row___35U44",templateInput:"templateInput___3qfFR",errInput:"errInput___2Sb3-",table:"table___3-dMD"}},66635:function($,B,n){"use strict";n.r(B),n.d(B,{default:function(){return oe}});var Me=n(59319),X=n(34866),Fe=n(63185),q=n(9676),Le=n(57663),S=n(27884),$e=n(34792),T=n(0),k=n(86582),f=n(2824),Be=n(47673),O=n(20086),_=n(75941),o=n.n(_),a=n(67294),Y=n(7869),ee=n.n(Y),te=n(30381),N=n.n(te);function ae(i){for(var c=new ArrayBuffer(i.length),r=new Uint8Array(c),s=0;s<i.length;s++)r[s]=i.charCodeAt(s)&255;return c}function ne(i){var c=ee().write({SheetNames:["sheet1"],Sheets:{sheet1:i}},{bookType:"xlsx",bookSST:!1,type:"binary"}),r=new Blob([ae(c)],{type:"application/octet-stream"});return r}function re(i){var c=ne(i),r=URL.createObjectURL(c),s=document.createElement("a");s.href=r,s.download="".concat(N()().format("YYYY_MM_DD"),".xlsx"),s.innerText="".concat(N()().format("YYYY_MM_DD"),".xlsx"),s.click(),URL.revokeObjectURL(r)}var z=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"index",c="https://neco86.github.io/templateReport/config/".concat(i,".json?t=").concat(Date.now());return fetch(c).then(function(r){return r.json()})},u=n(85893),le=O.Z.TextArea,ue=Y.utils.table_to_sheet,D=/MOMENT\(.+\)/g,Z="TEMPLATE_CONFIG",se=function i(c){return c.map(function(r){return{title:r.title.replace(D,function(s){return N()().format(s.slice(7,s.length-1))}),dataIndex:r.dataIndex,sorter:r.sorter?function(s,M){var C,x;return s[(C=r==null?void 0:r.dataIndex)!==null&&C!==void 0?C:0]-M[(x=r==null?void 0:r.dataIndex)!==null&&x!==void 0?x:0]}:void 0,children:r.children?i(r.children):void 0}})},oe=function(){var i=(0,a.useState)([]),c=(0,f.Z)(i,2),r=c[0],s=c[1],M=(0,a.useState)(""),C=(0,f.Z)(M,2),x=C[0],ie=C[1],ce=(0,a.useState)([]),U=(0,f.Z)(ce,2),y=U[0],de=U[1],ve=(0,a.useState)(!1),w=(0,f.Z)(ve,2),F=w[0],fe=w[1],me=(0,a.useState)(""),P=(0,f.Z)(me,2),I=P[0],V=P[1],he=(0,a.useState)([]),H=(0,f.Z)(he,2),E=H[0],pe=H[1],xe=(0,a.useState)([]),J=(0,f.Z)(xe,2),ge=J[0],L=J[1],Se=(0,a.useState)([]),G=(0,f.Z)(Se,2),Ce=G[0],ye=G[1],K=(0,a.useRef)(),Q=(0,a.useMemo)(function(){return y.length},[y]),m=(0,a.useMemo)(function(){return(0,k.Z)(new Array(Q)).map(function(){return""})},[Q]),Ie=(0,a.useState)(m),W=(0,f.Z)(Ie,2),g=W[0],R=W[1],be=(0,a.useMemo)(function(){return x.split(`
`).filter(Boolean).map(function(e){return e.split(/(\$\{[0-9]+\})/g).filter(Boolean).map(function(t){return/\$\{[0-9]+\}/.test(t)?{type:"input",dataIndex:+t.slice(2,t.length-1)}:{type:"text",value:t}})})},[x]),je=(0,a.useCallback)(function(e){return function(t){R(m.map(function(l,v){var d;return v===e?t.target.value:(d=g==null?void 0:g[v])!==null&&d!==void 0?d:""}))}},[g,m]),Ae=(0,a.useCallback)(function(){pe([].concat((0,k.Z)(E),[g])),V(""),R(m),L([]),K.current.focus()},[E,m,g]),j=(0,a.useCallback)(function(){R(m),L([])},[m]),A=(0,a.useCallback)(function(e){var t=(0,k.Z)(m),l=[];y.forEach(function(v,d){var h,p;t[d]=(h=(p=e.replace(/\s/g,"").match(v))===null||p===void 0?void 0:p[1])!==null&&h!==void 0?h:"",t[d]||l.push(d)}),R(t),L(l)},[m,y]),Ne=(0,a.useCallback)(function(){var e=ue(document.getElementById("table"));re(e)},[]),Ze=(0,a.useCallback)(function(e){var t=e.target.checked;fe(t),t&&(j(),I&&A(I))},[j,A,I]),Ee=(0,a.useCallback)(function(e){var t=e.target.value;V(t),F&&(j(),t&&A(t))},[F,j,A]),b=(0,a.useCallback)(function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;!e||!e.wordTemplate||!e.columns||!e.parseRules?(T.default.error("\u914D\u7F6E\u6587\u4EF6\u4E0D\u6B63\u786E!"),localStorage.removeItem(Z)):(localStorage.setItem(Z,JSON.stringify(e)),ie(e.wordTemplate.replace(D,function(l){return N()().format(l.slice(7,l.length-1))})),s(se(e.columns)),de(e.parseRules.map(function(l){return new RegExp(l)})),t||T.default.success("\u5BFC\u5165\u914D\u7F6E\u6210\u529F!"))},[]),Re=(0,a.useCallback)(function(){var e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=function(t){var l,v,d=t==null||(l=t.target)===null||l===void 0||(v=l.files)===null||v===void 0?void 0:v[0];if(d){var h=new FileReader;h.onload=function(){var p=h.result;try{var ke=JSON.parse(p);b(ke)}catch(Oe){T.default.error("\u914D\u7F6E\u4E0D\u6B63\u786E!")}},h.readAsText(d,"UTF-8")}},e.click()},[b]);(0,a.useEffect)(function(){z().then(function(e){var t=e.list;ye(t)})},[]);var Te=(0,a.useCallback)(function(e){z(e).then(b)},[b]);return(0,a.useEffect)(function(){try{var e=JSON.parse(localStorage.getItem(Z));e&&b(e,!0)}catch(t){localStorage.removeItem(Z)}},[b]),(0,u.jsxs)("div",{className:o().wrapper,children:[(0,u.jsxs)("div",{className:o().config,children:[(0,u.jsx)(S.Z,{size:"small",onClick:Re,children:"\u5BFC\u5165\u914D\u7F6E"}),Ce.map(function(e){var t=e.name,l=e.fileName;return(0,u.jsx)(S.Z,{size:"small",onClick:function(){return Te(l)},children:t},l)})]}),(0,u.jsxs)("div",{className:o().workArea,children:[(0,u.jsx)(le,{ref:K,autoFocus:!0,className:o().input,value:I,onChange:Ee}),(0,u.jsxs)("div",{children:[(0,u.jsx)(S.Z,{className:o().btn,size:"small",type:"primary",onClick:function(){return A(I)},disabled:!I,children:"\u89E3\u6790\u2192"}),(0,u.jsx)(q.Z,{className:o().btn,checked:F,onChange:Ze,children:"\u81EA\u52A8\u2192"})]}),(0,u.jsxs)("div",{className:o().parseResult,children:[be.map(function(e,t){return(0,u.jsx)("div",{className:o().row,children:e.map(function(l,v){var d=l.type,h=l.value,p=l.dataIndex;return(0,u.jsxs)(a.Fragment,{children:[d==="input"&&(0,u.jsx)(O.Z,{value:g[p],onChange:je(p),className:"".concat(o().templateInput," ").concat(ge.includes(p)&&o().errInput),size:"small"}),d==="text"&&h]},"".concat(t,"_").concat(v))})},t)}),(0,u.jsxs)("div",{className:o().row,children:[(0,u.jsx)(S.Z,{size:"small",type:"primary",onClick:Ae,disabled:!x||!y.length,children:"\u786E\u8BA4"}),(0,u.jsx)(S.Z,{size:"small",type:"primary",danger:!0,onClick:j,disabled:!x||!y.length,children:"\u6E05\u7A7A"})]})]})]}),(0,u.jsx)(S.Z,{className:o().btn,size:"small",type:"primary",disabled:!E.length,onClick:Ne,children:"\u5BFC\u51FA"}),(0,u.jsx)(X.Z,{id:"table",className:o().table,columns:r,dataSource:E,bordered:!0,pagination:!1})]})}},18685:function(){},20067:function(){},55382:function(){},72095:function(){},61219:function(){}}]);
