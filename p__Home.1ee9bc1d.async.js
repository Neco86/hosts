(self.webpackChunktest=self.webpackChunktest||[]).push([[371],{75941:function(F){F.exports={wrapper:"wrapper___3iih1",config:"config___1jRLL",workArea:"workArea___3Z94m",input:"input___3IKyb",btn:"btn___h4QN4",parseResult:"parseResult___2m4fz",row:"row___35U44",templateInput:"templateInput___3qfFR",errInput:"errInput___2Sb3-",table:"table___3-dMD"}},66635:function(F,L,n){"use strict";n.r(L),n.d(L,{default:function(){return se}});var ke=n(59319),W=n(34866),Me=n(63185),X=n(9676),Fe=n(57663),S=n(27884),Le=n(34792),T=n(0),R=n(86582),f=n(2824),Be=n(47673),B=n(20086),q=n(75941),o=n.n(q),a=n(67294),O=n(7869),_=n.n(O),ee=n(30381),j=n.n(ee);function te(i){for(var c=new ArrayBuffer(i.length),r=new Uint8Array(c),s=0;s<i.length;s++)r[s]=i.charCodeAt(s)&255;return c}function ae(i){var c=_().write({SheetNames:["sheet1"],Sheets:{sheet1:i}},{bookType:"xlsx",bookSST:!1,type:"binary"}),r=new Blob([te(c)],{type:"application/octet-stream"});return r}function ne(i){var c=ae(i),r=URL.createObjectURL(c),s=document.createElement("a");s.href=r,s.download="".concat(j()().format("YYYY_MM_DD"),".xlsx"),s.innerText="".concat(j()().format("YYYY_MM_DD"),".xlsx"),s.click(),URL.revokeObjectURL(r)}var Y=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"index",c="https://neco86.github.io/templateReport/config/".concat(i,".json?t=").concat(Date.now());return fetch(c).then(function(r){return r.json()})},u=n(85893),re=B.Z.TextArea,le=O.utils.table_to_sheet,w=/MOMENT\(.+\)/g,A="TEMPLATE_CONFIG",ue=function i(c){return c.map(function(r){return{title:r.title.replace(w,function(s){return j()().format(s.slice(7,s.length-1))}),dataIndex:r.dataIndex,sorter:r.sorter?function(s,$){var g,v;return s[(g=r==null?void 0:r.dataIndex)!==null&&g!==void 0?g:0]-$[(v=r==null?void 0:r.dataIndex)!==null&&v!==void 0?v:0]}:void 0,children:r.children?i(r.children):void 0}})},se=function(){var i=(0,a.useState)([]),c=(0,f.Z)(i,2),r=c[0],s=c[1],$=(0,a.useState)(""),g=(0,f.Z)($,2),v=g[0],oe=g[1],ie=(0,a.useState)([]),z=(0,f.Z)(ie,2),N=z[0],ce=z[1],de=(0,a.useState)(!1),D=(0,f.Z)(de,2),k=D[0],ve=D[1],fe=(0,a.useState)(""),U=(0,f.Z)(fe,2),C=U[0],P=U[1],me=(0,a.useState)([]),V=(0,f.Z)(me,2),Z=V[0],he=V[1],pe=(0,a.useState)([]),H=(0,f.Z)(pe,2),xe=H[0],M=H[1],J=(0,a.useRef)(),Se=(0,a.useMemo)(function(){return v.split(`
`).filter(Boolean).map(function(e){return e.split(/(\$\{[0-9]+\})/g).filter(Boolean).map(function(t){return/\$\{[0-9]+\}/.test(t)?{type:"input",dataIndex:+t.slice(2,t.length-1)}:{type:"text",value:t}})})},[v]),G=(0,a.useMemo)(function(){var e,t;return((e=(t=v.split(/(\$\{[0-9]+\})/g).filter(function(l){return/\$\{[0-9]+\}/.test(l)}).map(function(l){return+l.slice(2,l.length-1)}).sort(function(l,d){return d-l}))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:-1)+1},[v]),x=(0,a.useMemo)(function(){return(0,R.Z)(new Array(G)).map(function(){return""})},[G]),ge=(0,a.useState)(x),K=(0,f.Z)(ge,2),I=K[0],E=K[1],Ce=(0,a.useCallback)(function(e){return function(t){E(I.map(function(l,d){return d===e?t.target.value:l}))}},[I]),ye=(0,a.useCallback)(function(){he([].concat((0,R.Z)(Z),[I])),P(""),E(x),M([]),J.current.focus()},[Z,x,I]),Ie=(0,a.useCallback)(function(){E(x),M([])},[x]),b=(0,a.useCallback)(function(e){var t=(0,R.Z)(x),l=[];N.forEach(function(d,m){var h,p;t[m]=(h=(p=e.replace(/\s/g,"").match(d))===null||p===void 0?void 0:p[1])!==null&&h!==void 0?h:"",t[m]||l.push(m)}),E(t),M(l)},[x,N]),be=(0,a.useCallback)(function(){var e=le(document.getElementById("table"));ne(e)},[]),je=(0,a.useCallback)(function(e){var t=e.target.checked;ve(t),t&&C&&b(C)},[b,C]),Ae=(0,a.useCallback)(function(e){var t=e.target.value;P(t),k&&t&&b(t)},[k,b]),y=(0,a.useCallback)(function(e){!e||!e.wordTemplate||!e.columns||!e.parseRules?(T.default.error("\u914D\u7F6E\u6587\u4EF6\u4E0D\u6B63\u786E!"),localStorage.removeItem(A)):(localStorage.setItem(A,JSON.stringify(e)),oe(e.wordTemplate.replace(w,function(t){return j()().format(t.slice(7,t.length-1))})),s(ue(e.columns)),ce(e.parseRules.map(function(t){return new RegExp(t)})),T.default.success("\u5BFC\u5165\u914D\u7F6E\u6210\u529F!"))},[]),Ne=(0,a.useCallback)(function(){var e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=function(t){var l,d,m=t==null||(l=t.target)===null||l===void 0||(d=l.files)===null||d===void 0?void 0:d[0];if(m){var h=new FileReader;h.onload=function(){var p=h.result;try{var $e=JSON.parse(p);y($e)}catch(Oe){T.default.error("\u914D\u7F6E\u4E0D\u6B63\u786E!")}},h.readAsText(m,"UTF-8")}},e.click()},[y]),Ze=(0,a.useState)([]),Q=(0,f.Z)(Ze,2),Ee=Q[0],Te=Q[1];(0,a.useEffect)(function(){Y().then(function(e){var t=e.list;Te(t)})},[]);var Re=(0,a.useCallback)(function(e){Y(e).then(y)},[y]);return(0,a.useEffect)(function(){try{var e=JSON.parse(localStorage.getItem(A));e&&y(e)}catch(t){localStorage.removeItem(A)}},[y]),(0,u.jsxs)("div",{className:o().wrapper,children:[(0,u.jsxs)("div",{className:o().config,children:[(0,u.jsx)(S.Z,{size:"small",onClick:Ne,children:"\u5BFC\u5165\u914D\u7F6E"}),Ee.map(function(e){var t=e.name,l=e.fileName;return(0,u.jsx)(S.Z,{size:"small",onClick:function(){return Re(l)},children:t},l)})]}),(0,u.jsxs)("div",{className:o().workArea,children:[(0,u.jsx)(re,{ref:J,autoFocus:!0,className:o().input,value:C,onChange:Ae}),(0,u.jsxs)("div",{children:[(0,u.jsx)(S.Z,{className:o().btn,size:"small",type:"primary",onClick:function(){return b(C)},disabled:!C,children:"\u89E3\u6790\u2192"}),(0,u.jsx)(X.Z,{className:o().btn,checked:k,onChange:je,children:"\u81EA\u52A8\u2192"})]}),(0,u.jsxs)("div",{className:o().parseResult,children:[Se.map(function(e,t){return(0,u.jsx)("div",{className:o().row,children:e.map(function(l,d){var m=l.type,h=l.value,p=l.dataIndex;return(0,u.jsxs)(a.Fragment,{children:[m==="input"&&(0,u.jsx)(B.Z,{value:I[p],onChange:Ce(p),className:"".concat(o().templateInput," ").concat(xe.includes(p)&&o().errInput),size:"small"}),m==="text"&&h]},"".concat(t,"_").concat(d))})},t)}),(0,u.jsxs)("div",{className:o().row,children:[(0,u.jsx)(S.Z,{size:"small",type:"primary",onClick:ye,disabled:!v||!N.length,children:"\u786E\u8BA4"}),(0,u.jsx)(S.Z,{size:"small",type:"primary",danger:!0,onClick:Ie,disabled:!v||!N.length,children:"\u6E05\u7A7A"})]})]})]}),(0,u.jsx)(S.Z,{className:o().btn,size:"small",type:"primary",disabled:!Z.length,onClick:be,children:"\u5BFC\u51FA"}),(0,u.jsx)(W.Z,{id:"table",className:o().table,columns:r,dataSource:Z,bordered:!0,pagination:!1})]})}},18685:function(){},20067:function(){},55382:function(){},72095:function(){},61219:function(){}}]);
