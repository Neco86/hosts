(self.webpackChunktest=self.webpackChunktest||[]).push([[371],{75941:function(F){F.exports={wrapper:"wrapper___3iih1",config:"config___1jRLL",workArea:"workArea___3Z94m",input:"input___3IKyb",btn:"btn___h4QN4",parseResult:"parseResult___2m4fz",row:"row___35U44",templateInput:"templateInput___3qfFR",errInput:"errInput___2Sb3-",table:"table___3-dMD"}},66635:function(F,L,r){"use strict";r.r(L),r.d(L,{default:function(){return se}});var ke=r(59319),W=r(34866),Me=r(63185),X=r(9676),Fe=r(57663),g=r(27884),Le=r(34792),T=r(0),R=r(86582),f=r(2824),Be=r(47673),B=r(20086),q=r(75941),o=r.n(q),n=r(67294),O=r(7869),_=r.n(O),ee=r(30381),j=r.n(ee);function te(i){for(var c=new ArrayBuffer(i.length),l=new Uint8Array(c),s=0;s<i.length;s++)l[s]=i.charCodeAt(s)&255;return c}function ae(i){var c=_().write({SheetNames:["sheet1"],Sheets:{sheet1:i}},{bookType:"xlsx",bookSST:!1,type:"binary"}),l=new Blob([te(c)],{type:"application/octet-stream"});return l}function ne(i){var c=ae(i),l=URL.createObjectURL(c),s=document.createElement("a");s.href=l,s.download="".concat(j()().format("YYYY_MM_DD"),".xlsx"),s.innerText="".concat(j()().format("YYYY_MM_DD"),".xlsx"),s.click(),URL.revokeObjectURL(l)}var Y=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"index",c="https://neco86.github.io/templateReport/config/".concat(i,".json?t=").concat(Date.now());return fetch(c).then(function(l){return l.json()})},u=r(85893),re=B.Z.TextArea,le=O.utils.table_to_sheet,w=/MOMENT\(.+\)/g,A="TEMPLATE_CONFIG",ue=function i(c){return c.map(function(l){return{title:l.title.replace(w,function(s){return j()().format(s.slice(7,s.length-1))}),dataIndex:l.dataIndex,sorter:l.sorter?function(s,$){var S,v;return s[(S=l==null?void 0:l.dataIndex)!==null&&S!==void 0?S:0]-$[(v=l==null?void 0:l.dataIndex)!==null&&v!==void 0?v:0]}:void 0,children:l.children?i(l.children):void 0}})},se=function(){var i=(0,n.useState)([]),c=(0,f.Z)(i,2),l=c[0],s=c[1],$=(0,n.useState)(""),S=(0,f.Z)($,2),v=S[0],oe=S[1],ie=(0,n.useState)([]),z=(0,f.Z)(ie,2),N=z[0],ce=z[1],de=(0,n.useState)(!1),D=(0,f.Z)(de,2),k=D[0],ve=D[1],fe=(0,n.useState)(""),U=(0,f.Z)(fe,2),C=U[0],P=U[1],me=(0,n.useState)([]),V=(0,f.Z)(me,2),Z=V[0],he=V[1],pe=(0,n.useState)([]),H=(0,f.Z)(pe,2),xe=H[0],M=H[1],J=(0,n.useRef)(),ge=(0,n.useMemo)(function(){return v.split(`
`).filter(Boolean).map(function(e){return e.split(/(\$\{[0-9]+\})/g).filter(Boolean).map(function(t){return/\$\{[0-9]+\}/.test(t)?{type:"input",dataIndex:+t.slice(2,t.length-1)}:{type:"text",value:t}})})},[v]),G=(0,n.useMemo)(function(){var e,t;return((e=(t=v.split(/(\$\{[0-9]+\})/g).filter(function(a){return/\$\{[0-9]+\}/.test(a)}).map(function(a){return+a.slice(2,a.length-1)}).sort(function(a,d){return d-a}))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:-1)+1},[v]),x=(0,n.useMemo)(function(){return(0,R.Z)(new Array(G)).map(function(){return""})},[G]),Se=(0,n.useState)(x),K=(0,f.Z)(Se,2),I=K[0],E=K[1],Ce=(0,n.useCallback)(function(e){return function(t){E(I.map(function(a,d){return d===e?t.target.value:a}))}},[I]),ye=(0,n.useCallback)(function(){he([].concat((0,R.Z)(Z),[I])),P(""),E(x),M([]),J.current.focus()},[Z,x,I]),Ie=(0,n.useCallback)(function(){E(x),M([])},[x]),b=(0,n.useCallback)(function(e){var t=(0,R.Z)(x),a=[];N.forEach(function(d,m){var h,p;t[m]=(h=(p=e.replace(/\s/g,"").match(d))===null||p===void 0?void 0:p[1])!==null&&h!==void 0?h:"",t[m]||a.push(m)}),E(t),M(a)},[x,N]),be=(0,n.useCallback)(function(){var e=le(document.getElementById("table"));ne(e)},[]),je=(0,n.useCallback)(function(e){var t=e.target.checked;ve(t),t&&C&&b(C)},[b,C]),Ae=(0,n.useCallback)(function(e){var t=e.target.value;P(t),k&&t&&b(t)},[k,b]),y=(0,n.useCallback)(function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;!e||!e.wordTemplate||!e.columns||!e.parseRules?(T.default.error("\u914D\u7F6E\u6587\u4EF6\u4E0D\u6B63\u786E!"),localStorage.removeItem(A)):(localStorage.setItem(A,JSON.stringify(e)),oe(e.wordTemplate.replace(w,function(a){return j()().format(a.slice(7,a.length-1))})),s(ue(e.columns)),ce(e.parseRules.map(function(a){return new RegExp(a)})),t||T.default.success("\u5BFC\u5165\u914D\u7F6E\u6210\u529F!"))},[]),Ne=(0,n.useCallback)(function(){var e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=function(t){var a,d,m=t==null||(a=t.target)===null||a===void 0||(d=a.files)===null||d===void 0?void 0:d[0];if(m){var h=new FileReader;h.onload=function(){var p=h.result;try{var $e=JSON.parse(p);y($e)}catch(Oe){T.default.error("\u914D\u7F6E\u4E0D\u6B63\u786E!")}},h.readAsText(m,"UTF-8")}},e.click()},[y]),Ze=(0,n.useState)([]),Q=(0,f.Z)(Ze,2),Ee=Q[0],Te=Q[1];(0,n.useEffect)(function(){Y().then(function(e){var t=e.list;Te(t)})},[]);var Re=(0,n.useCallback)(function(e){Y(e).then(y)},[y]);return(0,n.useEffect)(function(){try{var e=JSON.parse(localStorage.getItem(A));e&&y(e,!0)}catch(t){localStorage.removeItem(A)}},[y]),(0,u.jsxs)("div",{className:o().wrapper,children:[(0,u.jsxs)("div",{className:o().config,children:[(0,u.jsx)(g.Z,{size:"small",onClick:Ne,children:"\u5BFC\u5165\u914D\u7F6E"}),Ee.map(function(e){var t=e.name,a=e.fileName;return(0,u.jsx)(g.Z,{size:"small",onClick:function(){return Re(a)},children:t},a)})]}),(0,u.jsxs)("div",{className:o().workArea,children:[(0,u.jsx)(re,{ref:J,autoFocus:!0,className:o().input,value:C,onChange:Ae}),(0,u.jsxs)("div",{children:[(0,u.jsx)(g.Z,{className:o().btn,size:"small",type:"primary",onClick:function(){return b(C)},disabled:!C,children:"\u89E3\u6790\u2192"}),(0,u.jsx)(X.Z,{className:o().btn,checked:k,onChange:je,children:"\u81EA\u52A8\u2192"})]}),(0,u.jsxs)("div",{className:o().parseResult,children:[ge.map(function(e,t){return(0,u.jsx)("div",{className:o().row,children:e.map(function(a,d){var m=a.type,h=a.value,p=a.dataIndex;return(0,u.jsxs)(n.Fragment,{children:[m==="input"&&(0,u.jsx)(B.Z,{value:I[p],onChange:Ce(p),className:"".concat(o().templateInput," ").concat(xe.includes(p)&&o().errInput),size:"small"}),m==="text"&&h]},"".concat(t,"_").concat(d))})},t)}),(0,u.jsxs)("div",{className:o().row,children:[(0,u.jsx)(g.Z,{size:"small",type:"primary",onClick:ye,disabled:!v||!N.length,children:"\u786E\u8BA4"}),(0,u.jsx)(g.Z,{size:"small",type:"primary",danger:!0,onClick:Ie,disabled:!v||!N.length,children:"\u6E05\u7A7A"})]})]})]}),(0,u.jsx)(g.Z,{className:o().btn,size:"small",type:"primary",disabled:!Z.length,onClick:be,children:"\u5BFC\u51FA"}),(0,u.jsx)(W.Z,{id:"table",className:o().table,columns:l,dataSource:Z,bordered:!0,pagination:!1})]})}},18685:function(){},20067:function(){},55382:function(){},72095:function(){},61219:function(){}}]);
